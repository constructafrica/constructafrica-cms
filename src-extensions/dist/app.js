import{useApi as e}from"@directus/extensions-sdk";import{ref as a,watch as n,resolveComponent as l,openBlock as t,createElementBlock as o,Fragment as r,renderList as d,createCommentVNode as i,createVNode as c,withCtx as s,createTextVNode as p,toDisplayString as m,createElementVNode as u}from"vue";import{useI18n as v}from"vue-i18n";var f=[],y=[];!function(e,a){if(e&&"undefined"!=typeof document){var n,l=!0===a.prepend?"prepend":"append",t=!0===a.singleTag,o="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(t){var r=f.indexOf(o);-1===r&&(r=f.push(o)-1,y[r]={}),n=y[r]&&y[r][l]?y[r][l]:y[r][l]=d()}else n=d();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function d(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var n=Object.keys(a.attributes),t=0;t<n.length;t++)e.setAttribute(n[t],a.attributes[n[t]]);var r="prepend"===l?"afterbegin":"beforeend";return o.insertAdjacentElement(r,e),e}}("\n.project-companies-selector[data-v-2aefb3b3] {\n  padding: 12px;\n  background-color: var(--theme--background-subdued);\n  border-radius: var(--theme--border-radius);\n}\n.company-row[data-v-2aefb3b3] {\n  display: grid;\n  grid-template-columns: 200px 1fr 40px;\n  gap: 12px;\n  align-items: center;\n  margin-bottom: 12px;\n  padding: 12px;\n  background-color: var(--theme--background);\n  border-radius: var(--theme--border-radius);\n  border: 2px solid var(--theme--border-color-subdued);\n}\n.role-select[data-v-2aefb3b3],\n.company-select[data-v-2aefb3b3] {\n  width: 100%;\n}\n.remove-btn[data-v-2aefb3b3] {\n  color: var(--theme--danger);\n  cursor: pointer;\n  transition: transform 0.2s;\n}\n.remove-btn[data-v-2aefb3b3]:hover {\n  transform: scale(1.1);\n}\n.grid[data-v-2aefb3b3] {\n  display: grid;\n  gap: 20px;\n}\n.field[data-v-2aefb3b3] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.field.full[data-v-2aefb3b3] {\n  grid-column: 1 / -1;\n}\n.field.half[data-v-2aefb3b3] {\n  grid-column: span 1;\n}\n.type-label[data-v-2aefb3b3] {\n  font-weight: 600;\n  font-size: 14px;\n  color: var(--theme--foreground);\n}\n@media (max-width: 768px) {\n.company-row[data-v-2aefb3b3] {\n    grid-template-columns: 1fr;\n}\n.remove-btn[data-v-2aefb3b3] {\n    justify-self: end;\n}\n.field.half[data-v-2aefb3b3] {\n    grid-column: 1 / -1;\n}\n}\n",{});var b=(e,a)=>{const n=e.__vccOpts||e;for(const[e,l]of a)n[e]=l;return n};const g={props:{value:{type:Array,default:()=>[]},collection:{type:String,default:null}},emits:["input"],setup(l,{emit:t}){const o=e(),{t:r}=v(),d=a([]),i=a([]),c=a(!1),s=a(!1),p=a(null),m=a({name:"",email:"",phone:""});n(()=>l.value,e=>{e&&Array.isArray(e)&&(d.value=e.map(e=>({id:e.id||null,role:e.role||null,company_id:"object"==typeof e.company_id?e.company_id?.id:e.company_id})))},{immediate:!0});const u=async(e="")=>{try{const a=e?{name:{_contains:e}}:{},n=await o.get("/items/companies",{params:{fields:["id","name","email"],limit:100,filter:a,sort:["name"]}});i.value=n.data.data.map(e=>({text:e.name,value:e.id,company:e}))}catch(e){console.error("Error loading companies:",e)}};u();const f=()=>{const e=d.value.filter(e=>e.role&&e.company_id);t("input",e)};return{t:r,internalValue:d,roleOptions:[{text:"Architect",value:"architect"},{text:"Developer",value:"developer"},{text:"Contractor",value:"contractor"},{text:"Consultant",value:"consultant"},{text:"Engineer",value:"engineer"},{text:"Supplier",value:"supplier"},{text:"Project Manager",value:"project_manager"}],companyOptions:i,showCreateDialog:c,creating:s,newCompany:m,addItem:()=>{d.value.push({id:null,role:null,company_id:null}),f()},removeItem:e=>{d.value.splice(e,1),f()},handleCompanyChange:(e,a)=>{"string"!=typeof a||i.value.find(e=>e.value===a)?(d.value[e].company_id=a,f()):(p.value=e,m.value.name=a,c.value=!0)},createCompany:async()=>{if(m.value.name){s.value=!0;try{const e=(await o.post("/items/companies",m.value)).data.data;i.value.unshift({text:e.name,value:e.id,company:e}),null!==p.value&&(d.value[p.value].company_id=e.id,f()),c.value=!1,m.value={name:"",email:"",phone:""},p.value=null}catch(e){console.error("Error creating company:",e),alert("Failed to create company. Please try again.")}finally{s.value=!1}}},loadCompanies:u,updateValue:f}}},h={class:"project-companies-selector"},_={class:"grid"},C={class:"field full"},w={class:"type-label"},x={class:"field half"},V={class:"type-label"},k={class:"field half"},j={class:"type-label"};const A=[{id:"project-companies-selector",name:"Project Companies Selector",description:"Select companies with roles in a user-friendly interface",icon:"business",component:b(g,[["render",function(e,a,n,v,f,y){const b=l("v-select"),g=l("v-icon"),A=l("v-button"),D=l("v-card-title"),S=l("v-input"),U=l("v-card-text"),E=l("v-card-actions"),O=l("v-card"),T=l("v-dialog");return t(),o("div",h,[(t(!0),o(r,null,d(v.internalValue,(e,a)=>(t(),o("div",{key:e.id||`new-${a}`,class:"company-row"},[i(" Role Dropdown "),c(b,{modelValue:e.role,"onUpdate:modelValue":[a=>e.role=a,v.updateValue],items:v.roleOptions,placeholder:v.t("select_role"),class:"role-select"},null,8,["modelValue","onUpdate:modelValue","items","placeholder"]),i(" Company Dropdown with Search and Create "),c(b,{modelValue:e.company_id,"onUpdate:modelValue":[a=>e.company_id=a,e=>v.handleCompanyChange(a,e)],items:v.companyOptions,placeholder:v.t("search_or_create_company"),"show-deselect":!1,"allow-other":!0,class:"company-select",onGroupToggle:v.loadCompanies},{prepend:s(()=>[c(g,{name:"business",small:""})]),_:1},8,["modelValue","onUpdate:modelValue","items","placeholder","onGroupToggle"]),i(" Remove Button "),c(g,{name:"close",clickable:"",class:"remove-btn",onClick:e=>v.removeItem(a)},null,8,["onClick"])]))),128)),i(" Add New Button "),c(A,{secondary:"",small:"",onClick:v.addItem},{default:s(()=>[c(g,{name:"add",small:""}),p(" "+m(v.t("add_company")),1)]),_:1},8,["onClick"]),i(" Create Company Dialog "),c(T,{modelValue:v.showCreateDialog,"onUpdate:modelValue":a[4]||(a[4]=e=>v.showCreateDialog=e),onEsc:a[5]||(a[5]=e=>v.showCreateDialog=!1)},{default:s(()=>[c(O,null,{default:s(()=>[c(D,null,{default:s(()=>[p(m(v.t("create_new_company")),1)]),_:1}),c(U,null,{default:s(()=>[u("div",_,[u("div",C,[u("div",w,m(v.t("company_name")),1),c(S,{modelValue:v.newCompany.name,"onUpdate:modelValue":a[0]||(a[0]=e=>v.newCompany.name=e),placeholder:v.t("enter_company_name"),autofocus:""},null,8,["modelValue","placeholder"])]),u("div",x,[u("div",V,m(v.t("email")),1),c(S,{modelValue:v.newCompany.email,"onUpdate:modelValue":a[1]||(a[1]=e=>v.newCompany.email=e),type:"email",placeholder:v.t("enter_email")},null,8,["modelValue","placeholder"])]),u("div",k,[u("div",j,m(v.t("phone")),1),c(S,{modelValue:v.newCompany.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>v.newCompany.phone=e),placeholder:v.t("enter_phone")},null,8,["modelValue","placeholder"])])])]),_:1}),c(E,null,{default:s(()=>[c(A,{secondary:"",onClick:a[3]||(a[3]=e=>v.showCreateDialog=!1)},{default:s(()=>[p(m(v.t("cancel")),1)]),_:1}),c(A,{loading:v.creating,disabled:!v.newCompany.name,onClick:v.createCompany},{default:s(()=>[p(m(v.t("create")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}],["__scopeId","data-v-2aefb3b3"],["__file","interface.vue"]]),options:null,types:["alias"],localTypes:["o2m"],group:"relational",relational:!0}],D=[],S=[],U=[],E=[],O=[],T=[];export{D as displays,A as interfaces,S as layouts,U as modules,T as operations,E as panels,O as themes};
