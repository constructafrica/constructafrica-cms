import{useApi as e}from"@directus/extensions-sdk";import{ref as a,reactive as n,onMounted as o,onBeforeUnmount as l,watch as t,resolveComponent as d,openBlock as r,createElementBlock as i,Fragment as c,renderList as s,createCommentVNode as p,createVNode as m,createElementVNode as u,withCtx as v,createBlock as y,toDisplayString as h,createTextVNode as f}from"vue";import{useI18n as g}from"vue-i18n";var w=[],_=[];!function(e,a){if(e&&"undefined"!=typeof document){var n,o=!0===a.prepend?"prepend":"append",l=!0===a.singleTag,t="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(l){var d=w.indexOf(t);-1===d&&(d=w.push(t)-1,_[d]={}),n=_[d]&&_[d][o]?_[d][o]:_[d][o]=r()}else n=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var n=Object.keys(a.attributes),l=0;l<n.length;l++)e.setAttribute(n[l],a.attributes[n[l]]);var d="prepend"===o?"afterbegin":"beforeend";return t.insertAdjacentElement(d,e),e}}("\n.project-companies-selector[data-v-d287c2d3] {\n  padding: 12px;\n  background-color: var(--theme--background-subdued);\n  border-radius: var(--theme--border-radius);\n}\n.company-row[data-v-d287c2d3] {\n  display: grid;\n  grid-template-columns: 200px 1fr 40px;\n  gap: 12px;\n  align-items: start;\n  margin-bottom: 12px;\n  padding: 12px;\n  background-color: var(--theme--background);\n  border-radius: var(--theme--border-radius);\n  border: 2px solid var(--theme--border-color-subdued);\n}\n.role-select[data-v-d287c2d3] {\n  width: 100%;\n}\n.company-select-wrapper[data-v-d287c2d3] {\n  position: relative;\n  width: 100%;\n}\n.company-dropdown[data-v-d287c2d3] {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 4px;\n  max-height: 300px;\n  overflow-y: auto;\n  background-color: var(--theme--background);\n  border: 2px solid var(--theme--border-color-subdued);\n  border-radius: var(--theme--border-radius);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  z-index: 100;\n}\n.company-option[data-v-d287c2d3] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px;\n  cursor: pointer;\n  transition: background-color 0.2s;\n}\n.company-option[data-v-d287c2d3]:hover {\n  background-color: var(--theme--background-subdued);\n}\n.company-option.create-new[data-v-d287c2d3] {\n  border-top: 2px solid var(--theme--border-color-subdued);\n  color: var(--theme--primary);\n  font-weight: 500;\n}\n.company-info[data-v-d287c2d3] {\n  flex: 1;\n  min-width: 0;\n}\n.company-name[data-v-d287c2d3] {\n  font-size: 14px;\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.company-email[data-v-d287c2d3] {\n  font-size: 12px;\n  color: var(--theme--foreground-subdued);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.no-results[data-v-d287c2d3] {\n  padding: 12px;\n  text-align: center;\n  color: var(--theme--foreground-subdued);\n  font-size: 14px;\n}\n.remove-btn[data-v-d287c2d3] {\n  color: var(--theme--danger);\n  cursor: pointer;\n  transition: transform 0.2s;\n  margin-top: 8px;\n}\n.remove-btn[data-v-d287c2d3]:hover {\n  transform: scale(1.1);\n}\n.grid[data-v-d287c2d3] {\n  display: grid;\n  gap: 20px;\n}\n.field[data-v-d287c2d3] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.field.full[data-v-d287c2d3] {\n  grid-column: 1 / -1;\n}\n.field.half[data-v-d287c2d3] {\n  grid-column: span 1;\n}\n.type-label[data-v-d287c2d3] {\n  font-weight: 600;\n  font-size: 14px;\n  color: var(--theme--foreground);\n}\n@media (max-width: 768px) {\n.company-row[data-v-d287c2d3] {\n    grid-template-columns: 1fr;\n}\n.remove-btn[data-v-d287c2d3] {\n    justify-self: end;\n    margin-top: 0;\n}\n.field.half[data-v-d287c2d3] {\n    grid-column: 1 / -1;\n}\n}\n",{});var b=(e,a)=>{const n=e.__vccOpts||e;for(const[e,o]of a)n[e]=o;return n};const x={props:{value:{type:Array,default:()=>[]},collection:{type:String,default:null},primaryKey:{type:[String,Number],default:null}},emits:["input"],setup(d,{emit:r}){const i=e(),{t:c}=g(),s=a([]),p=a([]),m=n({}),u=n({}),v=n({}),y=n({}),h=a(!1),f=a(!1),w=a(!1),_=a(!1),b=a(null),x=a(null),C={},k=a({name:"",email:"",phone:""}),V=async(e,a)=>{if(!a||a.length<2)u[e]=[];else{b.value=e,_.value=!0;try{const n=await i.get("/items/companies",{params:{fields:["id","name","email"],limit:50,filter:{name:{_icontains:a}},sort:["name"]}});u[e]=n.data.data.map(e=>({text:e.name,value:e.id,company:e}))}catch(a){console.error("Error searching companies:",a),u[e]=[]}finally{_.value=!1,b.value=null}}};o(async()=>{console.log("Component mounted, primaryKey:",d.primaryKey),await(async()=>{w.value=!0;try{const e=await i.get("/items/project_company_roles",{params:{fields:["id","name","slug"],limit:-1,sort:["name"]}});p.value=e.data.data.map(e=>({text:e.name,value:e.id}))}catch(e){console.error("Error loading roles:",e)}finally{w.value=!1}})(),await(async()=>{if(d.primaryKey)try{const e=await i.get("/items/project_companies",{params:{filter:{project_id:{_eq:d.primaryKey}},fields:["id","role_id","company_id.id","company_id.name"],limit:-1}});e.data.data.length>0?(s.value=[],e.data.data.forEach((e,a)=>{const n="object"==typeof e.company_id?e.company_id.id:e.company_id,o="object"==typeof e.company_id?e.company_id.name:"";s.value.push({id:e.id,role_id:e.role_id,company_id:n}),o&&(m[a]=o,y[a]=o),u[a]=[],v[a]=!1})):j()}catch(e){console.error("Error loading existing data:",e),0===s.value.length&&j()}else 0===s.value.length&&j()})(),console.log("After loadExistingData:",{internalValue:s.value,searchQueries:{...m}}),document.addEventListener("click",E)}),l(()=>{document.removeEventListener("click",E),Object.values(C).forEach(e=>clearTimeout(e))});const E=e=>{e.target.closest(".company-select-wrapper")||Object.keys(v).forEach(e=>{v[e]=!1})};t(()=>d.value,e=>{e&&Array.isArray(e)&&e.length>0&&(s.value=e.map(e=>({id:e.id||null,role_id:e.role_id||null,company_id:"object"==typeof e.company_id?e.company_id?.id:e.company_id})))},{deep:!0});const j=()=>{const e=s.value.length;s.value.push({id:null,role_id:null,company_id:null}),m[e]="",u[e]=[],v[e]=!1,S()},S=()=>{const e=s.value.filter(e=>e.role_id&&e.company_id).map(e=>({id:e.id,role_id:e.role_id,company_id:e.company_id}));r("input",e.length>0?e:[])};return{t:c,internalValue:s,roleOptions:p,searchQueries:m,filteredCompanies:u,showDropdown:v,selectedCompanyNames:y,showCreateDialog:h,creating:f,loadingRoles:w,loadingCompanies:_,activeSearchIndex:b,newCompany:k,addItem:j,removeItem:e=>{s.value.splice(e,1),delete m[e],delete u[e],delete v[e],delete y[e],S()},handleSearchInput:(e,a)=>{m[e]=a,v[e]=!0,C[e]&&clearTimeout(C[e]),C[e]=setTimeout(()=>{V(e,a)},300)},handleSearchFocus:e=>{v[e]=!0,m[e]&&m[e].length>=2&&V(e,m[e])},selectCompany:(e,a)=>{s.value[e].company_id=a.value,m[e]=a.text,y[e]=a.text,v[e]=!1,S()},companyExistsInResults:e=>{const a=m[e]?.toLowerCase();return u[e]?.some(e=>e.text.toLowerCase()===a)},handleCreateNew:e=>{x.value=e,k.value.name=m[e],v[e]=!1,h.value=!0},createCompany:async()=>{if(k.value.name){f.value=!0;try{const e=(await i.post("/items/companies",k.value)).data.data;if(null!==x.value){const a=x.value;s.value[a].company_id=e.id,m[a]=e.name,y[a]=e.name,S()}h.value=!1,k.value={name:"",email:"",phone:""},x.value=null}catch(e){console.error("Error creating company:",e),alert("Failed to create company. Please try again.")}finally{f.value=!1}}},updateValue:S}}},C={class:"project-companies-selector"},k={class:"company-select-wrapper"},V={key:0,class:"company-dropdown"},E=["onClick"],j={class:"company-info"},S={class:"company-name"},D={key:0,class:"company-email"},I=["onClick"],A={class:"company-info"},N={class:"company-name"},T={key:1,class:"no-results"},O={class:"grid"},Q={class:"field full"},U={class:"type-label"},R={class:"field half"},z={class:"type-label"},F={class:"field half"},K={class:"type-label"};const L=[{id:"project-companies-selector",name:"Project Companies Selector",description:"Select companies with roles in a user-friendly interface",icon:"business",component:b(x,[["render",function(e,a,n,o,l,t){const g=d("v-select"),w=d("v-icon"),_=d("v-input"),b=d("v-button"),x=d("v-card-title"),L=d("v-card-text"),B=d("v-card-actions"),q=d("v-card"),P=d("v-dialog");return r(),i("div",C,[(r(!0),i(c,null,s(o.internalValue,(e,a)=>(r(),i("div",{key:e.id||`new-${a}`,class:"company-row"},[p(" Role Dropdown "),m(g,{modelValue:e.role_id,"onUpdate:modelValue":[a=>e.role_id=a,o.updateValue],items:o.roleOptions,"item-title":"text","item-value":"value",placeholder:o.t("select_role"),loading:o.loadingRoles,class:"role-select"},null,8,["modelValue","onUpdate:modelValue","items","placeholder","loading"]),p(" Company Search Input with Dropdown "),u("div",k,[m(_,{"model-value":o.searchQueries[a]||"",placeholder:o.t("search_or_create_company"),"onUpdate:modelValue":e=>o.handleSearchInput(a,e),onFocus:e=>o.handleSearchFocus(a)},{prepend:v(()=>[m(w,{name:"business",small:""})]),append:v(()=>[o.loadingCompanies&&o.activeSearchIndex===a?(r(),y(w,{key:0,name:"refresh",small:"",spin:""})):p("v-if",!0)]),_:2},1032,["model-value","placeholder","onUpdate:modelValue","onFocus"]),p(" Dropdown Results "),o.showDropdown[a]&&(o.filteredCompanies[a]?.length>0||o.searchQueries[a]?.length>0)?(r(),i("div",V,[(r(!0),i(c,null,s(o.filteredCompanies[a],e=>(r(),i("div",{key:e.value,class:"company-option",onClick:n=>o.selectCompany(a,e)},[m(w,{name:"business",small:""}),u("div",j,[u("div",S,h(e.text),1),e.company?.email?(r(),i("div",D,h(e.company.email),1)):p("v-if",!0)])],8,E))),128)),p(" Create New Option "),o.searchQueries[a]&&o.searchQueries[a].length>2&&!o.companyExistsInResults(a)?(r(),i("div",{key:0,class:"company-option create-new",onClick:e=>o.handleCreateNew(a)},[m(w,{name:"add_circle",small:""}),u("div",A,[u("div",N,'Create "'+h(o.searchQueries[a])+'"',1)])],8,I)):p("v-if",!0),!o.loadingCompanies&&0===o.filteredCompanies[a]?.length&&o.searchQueries[a]?.length>0?(r(),i("div",T," No companies found. Type to create new. ")):p("v-if",!0)])):p("v-if",!0)]),p(" Remove Button "),m(w,{name:"close",clickable:"",class:"remove-btn",onClick:e=>o.removeItem(a)},null,8,["onClick"])]))),128)),p(" Add New Button "),m(b,{secondary:"",small:"",onClick:o.addItem},{default:v(()=>[m(w,{name:"add",small:""}),f(" "+h(o.t("add_company")),1)]),_:1},8,["onClick"]),p(" Create Company Dialog "),m(P,{modelValue:o.showCreateDialog,"onUpdate:modelValue":a[4]||(a[4]=e=>o.showCreateDialog=e),onEsc:a[5]||(a[5]=e=>o.showCreateDialog=!1)},{default:v(()=>[m(q,null,{default:v(()=>[m(x,null,{default:v(()=>[f(h(o.t("create_new_company")),1)]),_:1}),m(L,null,{default:v(()=>[u("div",O,[u("div",Q,[u("div",U,h(o.t("company_name")),1),m(_,{modelValue:o.newCompany.name,"onUpdate:modelValue":a[0]||(a[0]=e=>o.newCompany.name=e),placeholder:o.t("enter_company_name"),autofocus:""},null,8,["modelValue","placeholder"])]),u("div",R,[u("div",z,h(o.t("email")),1),m(_,{modelValue:o.newCompany.email,"onUpdate:modelValue":a[1]||(a[1]=e=>o.newCompany.email=e),type:"email",placeholder:o.t("enter_email")},null,8,["modelValue","placeholder"])]),u("div",F,[u("div",K,h(o.t("phone")),1),m(_,{modelValue:o.newCompany.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>o.newCompany.phone=e),placeholder:o.t("enter_phone")},null,8,["modelValue","placeholder"])])])]),_:1}),m(B,null,{default:v(()=>[m(b,{secondary:"",onClick:a[3]||(a[3]=e=>o.showCreateDialog=!1)},{default:v(()=>[f(h(o.t("cancel")),1)]),_:1}),m(b,{loading:o.creating,disabled:!o.newCompany.name,onClick:o.createCompany},{default:v(()=>[f(h(o.t("create")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}],["__scopeId","data-v-d287c2d3"],["__file","interface.vue"]]),options:null,types:["alias"],localTypes:["o2m"],group:"relational",relational:!0}],B=[],q=[],P=[],$=[],G=[],H=[];export{B as displays,L as interfaces,q as layouts,P as modules,H as operations,$ as panels,G as themes};
