const e=[{name:"my-hook",config:({filter:e,action:i})=>{e("items.create",()=>{console.log("Creating Item!")}),i("items.create",()=>{console.log("Item created!")})}}],i=[{name:"projects",config:(e,{services:i,exceptions:n})=>{const{ItemsService:a,AssetsService:r}=i;e.get("/",async(e,i,n)=>{try{const n=new a("projects",{schema:e.schema,accountability:e.accountability}),r=e.query.groupBy,t=await n.readByQuery({fields:["*","countries.countries_id.*","regions.regions_id.*","types.types_id.*","funding.funding_id.*","client_owner.companies_id.*","developer.companies_id.*","companies.companies_id.*","authority.*","architect.*","design_consultant.*","project_manager.*","civil_engineer.*","structural_engineer.*","mep_engineer.*","electrical_engineer.*","geotechnical_engineer.*","cost_consultants.*","quantity_surveyor.*","landscape_architect.*","legal_adviser.*","transaction_advisor.*","study_consultant.*","main_contractor.*","main_contract_bidder.*","main_contract_prequalified.*","mep_subcontractor.*","piling_subcontractor.*","facade_subcontractor.*","lift_subcontractor.*","other_subcontractor.*","operator.*","feed.*","featured_image.*"],limit:e.query.limit||-1,page:e.query.page||1,filter:e.query.filter||{}}),o=t.map(e=>{e.featured_image&&"object"==typeof e.featured_image&&e.featured_image.id&&(e.featured_image.url=`${process.env.PUBLIC_URL}/assets/${e.featured_image.id}`,e.featured_image.thumbnail_url=`${process.env.PUBLIC_URL}/assets/${e.featured_image.id}?width=400&height=300&fit=cover`);const i=e.countries?[...e.countries]:[],n=e.regions?[...e.regions]:[],a=e.types?[...e.types]:[],r=e.funding?[...e.funding]:[],t=e.companies?[...e.companies]:[],o=e.client_owner?[...e.client_owner]:[],s=e.developer?[...e.developer]:[];return e.countries&&Array.isArray(e.countries)&&(e.countries=e.countries.map(e=>e.countries_id).filter(Boolean)),e.regions&&Array.isArray(e.regions)&&(e.regions=e.regions.map(e=>e.regions_id).filter(Boolean)),e.types&&Array.isArray(e.types)&&(e.types=e.types.map(e=>e.types_id).filter(Boolean)),e.funding&&Array.isArray(e.funding)&&(e.funding=e.funding.map(e=>e.funding_id).filter(Boolean)),e.companies&&Array.isArray(e.companies)&&(e.companies=e.companies.map(e=>e.companies_id).filter(Boolean)),e.client_owner&&Array.isArray(e.client_owner)&&(e.client_owner=e.client_owner.map(e=>e.companies_id).filter(Boolean)),e.developer&&Array.isArray(e.developer)&&(e.developer=e.developer.map(e=>e.companies_id).filter(Boolean)),e._originals={countries:i,regions:n,types:a,funding:r,companies:t,client_owner:o,developer:s},e});if(r){const e=function(e,i){const n=new Map;return e.forEach(e=>{let a=[];switch(i){case"country":a=e._originals.countries.map(e=>({id:e.countries_id?.id,name:e.countries_id?.name||"Unknown Country",data:e.countries_id}));break;case"region":a=e._originals.regions.map(e=>({id:e.regions_id?.id,name:e.regions_id?.name||"Unknown Region",data:e.regions_id}));break;case"type":a=e._originals.types.map(e=>({id:e.types_id?.id,name:e.types_id?.name||"Unknown Type",data:e.types_id}));break;case"company":a=e._originals.companies.map(e=>({id:e.companies_id?.id,name:e.companies_id?.name||"Unknown Company",data:e.companies_id}));break;default:a=[{id:"all",name:"All Projects",data:null}]}0===a.length&&(a=[{id:"unknown",name:`Unknown ${i}`,data:null}]),a.forEach(i=>{n.has(i.id)||n.set(i.id,{id:i.id,name:i.name,data:i.data,projects:[],count:0,totalValue:0});const a=n.get(i.id),r={...e};delete r._originals,a.projects.push(r),a.count++,e.value&&(a.totalValue+=parseFloat(e.value)||0)})}),Array.from(n.values()).sort((e,i)=>e.name.localeCompare(i.name))}(o,r);i.json({data:e,meta:{total:o.length,groupBy:r,groups:e.length}})}else o.forEach(e=>delete e._originals),i.json({data:o,meta:{total:t.length,page:parseInt(e.query.page)||1,limit:parseInt(e.query.limit)||100}})}catch(e){n(e)}}),e.get("/:id",async(e,i,n)=>{try{const n=new a("projects",{schema:e.schema,accountability:e.accountability}),r=await n.readOne(e.params.id,{fields:["*","countries.countries_id.*","regions.regions_id.*","types.types_id.*","funding.funding_id.*","client_owner.companies_id.*","developer.companies_id.*","companies.companies_id.*","authority.*","architect.*","design_consultant.*","project_manager.*","civil_engineer.*","structural_engineer.*","mep_engineer.*","electrical_engineer.*","geotechnical_engineer.*","cost_consultants.*","quantity_surveyor.*","landscape_architect.*","legal_adviser.*","transaction_advisor.*","study_consultant.*","main_contractor.*","main_contract_bidder.*","main_contract_prequalified.*","mep_subcontractor.*","piling_subcontractor.*","facade_subcontractor.*","lift_subcontractor.*","other_subcontractor.*","operator.*","feed.*","featured_image.*"]});r.featured_image&&"object"==typeof r.featured_image&&r.featured_image.id&&(r.featured_image.url=`${process.env.PUBLIC_URL}/assets/${r.featured_image.id}`,r.featured_image.thumbnail_url=`${process.env.PUBLIC_URL}/assets/${r.featured_image.id}?width=400&height=300&fit=cover`),r.countries&&Array.isArray(r.countries)&&(r.countries=r.countries.map(e=>e.countries_id).filter(Boolean)),r.regions&&Array.isArray(r.regions)&&(r.regions=r.regions.map(e=>e.regions_id).filter(Boolean)),r.types&&Array.isArray(r.types)&&(r.types=r.types.map(e=>e.types_id).filter(Boolean)),r.funding&&Array.isArray(r.funding)&&(r.funding=r.funding.map(e=>e.funding_id).filter(Boolean)),r.companies&&Array.isArray(r.companies)&&(r.companies=r.companies.map(e=>e.companies_id).filter(Boolean)),r.client_owner&&Array.isArray(r.client_owner)&&(r.client_owner=r.client_owner.map(e=>e.companies_id).filter(Boolean)),r.developer&&Array.isArray(r.developer)&&(r.developer=r.developer.map(e=>e.companies_id).filter(Boolean)),i.json({data:r})}catch(e){n(e)}})}},{name:"test",config:(e,{services:i,exceptions:n})=>{e.get("/",(e,i)=>{i.json({status:"ok",message:"Test endpoint works!"})})}}],n=[];export{i as endpoints,e as hooks,n as operations};
