import{useApi as e}from"@directus/extensions-sdk";import{ref as a,onMounted as n,watch as l,resolveComponent as t,openBlock as o,createElementBlock as i,Fragment as r,renderList as d,createCommentVNode as c,createVNode as m,withCtx as s,createTextVNode as p,toDisplayString as u,createElementVNode as y}from"vue";import{useI18n as v}from"vue-i18n";var f=[],g=[];!function(e,a){if(e&&"undefined"!=typeof document){var n,l=!0===a.prepend?"prepend":"append",t=!0===a.singleTag,o="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(t){var i=f.indexOf(o);-1===i&&(i=f.push(o)-1,g[i]={}),n=g[i]&&g[i][l]?g[i][l]:g[i][l]=r()}else n=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var n=Object.keys(a.attributes),t=0;t<n.length;t++)e.setAttribute(n[t],a.attributes[n[t]]);var i="prepend"===l?"afterbegin":"beforeend";return o.insertAdjacentElement(i,e),e}}("\n.project-companies-selector[data-v-5589fc02] {\n  padding: 12px;\n  background-color: var(--theme--background-subdued);\n  border-radius: var(--theme--border-radius);\n}\n.company-row[data-v-5589fc02] {\n  display: grid;\n  grid-template-columns: 200px 1fr 40px;\n  gap: 12px;\n  align-items: center;\n  margin-bottom: 12px;\n  padding: 12px;\n  background-color: var(--theme--background);\n  border-radius: var(--theme--border-radius);\n  border: 2px solid var(--theme--border-color-subdued);\n}\n.role-select[data-v-5589fc02],\n.company-select[data-v-5589fc02] {\n  width: 100%;\n}\n.remove-btn[data-v-5589fc02] {\n  color: var(--theme--danger);\n  cursor: pointer;\n  transition: transform 0.2s;\n}\n.remove-btn[data-v-5589fc02]:hover {\n  transform: scale(1.1);\n}\n.grid[data-v-5589fc02] {\n  display: grid;\n  gap: 20px;\n}\n.field[data-v-5589fc02] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.field.full[data-v-5589fc02] {\n  grid-column: 1 / -1;\n}\n.field.half[data-v-5589fc02] {\n  grid-column: span 1;\n}\n.type-label[data-v-5589fc02] {\n  font-weight: 600;\n  font-size: 14px;\n  color: var(--theme--foreground);\n}\n@media (max-width: 768px) {\n.company-row[data-v-5589fc02] {\n    grid-template-columns: 1fr;\n}\n.remove-btn[data-v-5589fc02] {\n    justify-self: end;\n}\n.field.half[data-v-5589fc02] {\n    grid-column: 1 / -1;\n}\n}\n",{});var h=(e,a)=>{const n=e.__vccOpts||e;for(const[e,l]of a)n[e]=l;return n};const _={props:{value:{type:Array,default:()=>[]},collection:{type:String,default:null},primaryKey:{type:[String,Number],default:null}},emits:["input"],setup(t,{emit:o}){const i=e(),{t:r}=v(),d=a([]),c=a([]),m=a([]),s=a(!1),p=a(!1),u=a(!1),y=a(!1),f=a(null);let g=null;const h=a({name:"",email:"",phone:""}),_=async e=>{try{const a=(await i.get("/items/companies",{params:{filter:{id:{_in:e}},fields:["id","name","email"],limit:-1}})).data.data.map(e=>({text:e.name,value:e.id,company:e})),n=new Set(m.value.map(e=>e.value));a.forEach(e=>{n.has(e.value)||m.value.push(e)})}catch(e){console.error("Error loading selected companies:",e)}},b=async e=>{!e||e.length<2||(g&&clearTimeout(g),g=setTimeout(async()=>{y.value=!0;try{const a=e?{name:{_icontains:e}}:{},n=await i.get("/items/companies",{params:{fields:["id","name","email"],limit:100,filter:a,sort:["name"]}});m.value=n.data.data.map(e=>({text:e.name,value:e.id,company:e}))}catch(e){console.error("Error searching companies:",e)}finally{y.value=!1}},300))};n(async()=>{await(async()=>{u.value=!0;try{const e=await i.get("/items/project_company_roles",{params:{fields:["id","name","slug"],limit:-1,sort:["name"]}});c.value=e.data.data.map(e=>({text:e.name,value:e.id}))}catch(e){console.error("Error loading roles:",e)}finally{u.value=!1}})(),await(async()=>{if(t.primaryKey)try{const e=await i.get("/items/project_companies",{params:{filter:{project_id:{_eq:t.primaryKey}},fields:["id","role_id","company_id.id","company_id.name"],limit:-1}});if(e.data.data.length>0){d.value=e.data.data.map(e=>({id:e.id,role_id:e.role_id,company_id:"object"==typeof e.company_id?e.company_id.id:e.company_id}));const a=e.data.data.map(e=>"object"==typeof e.company_id?e.company_id.id:e.company_id).filter(Boolean);a.length>0&&await _(a)}}catch(e){console.error("Error loading existing data:",e)}})(),await b("")}),l(()=>t.value,e=>{e&&Array.isArray(e)&&e.length>0&&0===d.value.length&&(d.value=e.map(e=>({id:e.id||null,role_id:e.role_id||null,company_id:"object"==typeof e.company_id?e.company_id?.id:e.company_id})))});const w=()=>{const e=d.value.filter(e=>e.role_id&&e.company_id);o("input",e)};return{t:r,internalValue:d,roleOptions:c,companyOptions:m,showCreateDialog:s,creating:p,loadingRoles:u,loadingCompanies:y,newCompany:h,addItem:()=>{d.value.push({id:null,role_id:null,company_id:null}),w()},removeItem:e=>{d.value.splice(e,1),w()},handleCompanyChange:(e,a)=>{"string"!=typeof a||m.value.find(e=>e.value===a)?(d.value[e].company_id=a,w()):(f.value=e,h.value.name=a,s.value=!0)},createCompany:async()=>{if(h.value.name){p.value=!0;try{const e=(await i.post("/items/companies",h.value)).data.data;m.value.unshift({text:e.name,value:e.id,company:e}),null!==f.value&&(d.value[f.value].company_id=e.id,w()),s.value=!1,h.value={name:"",email:"",phone:""},f.value=null}catch(e){console.error("Error creating company:",e),alert("Failed to create company. Please try again.")}finally{p.value=!1}}},searchCompanies:b,updateValue:w}}},b={class:"project-companies-selector"},w={class:"grid"},C={class:"field full"},x={class:"type-label"},V={class:"field half"},k={class:"type-label"},j={class:"field half"},S={class:"type-label"};const E=[{id:"project-companies-selector",name:"Project Companies Selector",description:"Select companies with roles in a user-friendly interface",icon:"business",component:h(_,[["render",function(e,a,n,l,v,f){const g=t("v-select"),h=t("v-icon"),_=t("v-button"),E=t("v-card-title"),A=t("v-input"),D=t("v-card-text"),U=t("v-card-actions"),O=t("v-card"),T=t("v-dialog");return o(),i("div",b,[(o(!0),i(r,null,d(l.internalValue,(e,a)=>(o(),i("div",{key:e.id||`new-${a}`,class:"company-row"},[c(" Role Dropdown "),m(g,{modelValue:e.role_id,"onUpdate:modelValue":[a=>e.role_id=a,l.updateValue],items:l.roleOptions,"item-title":"text","item-value":"value",placeholder:l.t("select_role"),loading:l.loadingRoles,class:"role-select"},null,8,["modelValue","onUpdate:modelValue","items","placeholder","loading"]),c(" Company Dropdown with Search "),m(g,{modelValue:e.company_id,"onUpdate:modelValue":[a=>e.company_id=a,e=>l.handleCompanyChange(a,e)],items:l.companyOptions,"item-title":"text","item-value":"value",placeholder:l.t("search_or_create_company"),"show-deselect":!1,"allow-other":!0,loading:l.loadingCompanies,class:"company-select",onSearch:l.searchCompanies},{prepend:s(()=>[m(h,{name:"business",small:""})]),_:1},8,["modelValue","onUpdate:modelValue","items","placeholder","loading","onSearch"]),c(" Remove Button "),m(h,{name:"close",clickable:"",class:"remove-btn",onClick:e=>l.removeItem(a)},null,8,["onClick"])]))),128)),c(" Add New Button "),m(_,{secondary:"",small:"",onClick:l.addItem},{default:s(()=>[m(h,{name:"add",small:""}),p(" "+u(l.t("add_company")),1)]),_:1},8,["onClick"]),c(" Create Company Dialog "),m(T,{modelValue:l.showCreateDialog,"onUpdate:modelValue":a[4]||(a[4]=e=>l.showCreateDialog=e),onEsc:a[5]||(a[5]=e=>l.showCreateDialog=!1)},{default:s(()=>[m(O,null,{default:s(()=>[m(E,null,{default:s(()=>[p(u(l.t("create_new_company")),1)]),_:1}),m(D,null,{default:s(()=>[y("div",w,[y("div",C,[y("div",x,u(l.t("company_name")),1),m(A,{modelValue:l.newCompany.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.newCompany.name=e),placeholder:l.t("enter_company_name"),autofocus:""},null,8,["modelValue","placeholder"])]),y("div",V,[y("div",k,u(l.t("email")),1),m(A,{modelValue:l.newCompany.email,"onUpdate:modelValue":a[1]||(a[1]=e=>l.newCompany.email=e),type:"email",placeholder:l.t("enter_email")},null,8,["modelValue","placeholder"])]),y("div",j,[y("div",S,u(l.t("phone")),1),m(A,{modelValue:l.newCompany.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>l.newCompany.phone=e),placeholder:l.t("enter_phone")},null,8,["modelValue","placeholder"])])])]),_:1}),m(U,null,{default:s(()=>[m(_,{secondary:"",onClick:a[3]||(a[3]=e=>l.showCreateDialog=!1)},{default:s(()=>[p(u(l.t("cancel")),1)]),_:1}),m(_,{loading:l.creating,disabled:!l.newCompany.name,onClick:l.createCompany},{default:s(()=>[p(u(l.t("create")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}],["__scopeId","data-v-5589fc02"],["__file","interface.vue"]]),options:null,types:["alias"],localTypes:["o2m"],group:"relational",relational:!0}],A=[],D=[],U=[],O=[],T=[],I=[];export{A as displays,E as interfaces,D as layouts,U as modules,I as operations,O as panels,T as themes};
